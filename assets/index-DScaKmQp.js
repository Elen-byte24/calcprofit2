(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();let u=1,f=[];document.addEventListener("DOMContentLoaded",function(){console.log("DOM fully loaded"),u=1,f=[];const t=document.getElementById("add-tax"),e=document.getElementById("calculate"),o=document.getElementById("export-excel"),r=document.getElementById("export-pdf");t&&t.addEventListener("click",R),e&&e.addEventListener("click",O),o&&o.addEventListener("click",N),r&&r.addEventListener("click",A);const n=document.getElementById("results"),s=document.querySelector(".export-buttons");n&&(n.style.display="none"),s&&(s.style.display="none"),F()});function F(){for(let t=1;t<=12;t++){const e=document.getElementById(`price-increase-${t}`),o=document.getElementById(`price-increase-value-${t}`);e&&o&&(o.disabled=!0,e.addEventListener("change",function(){o.disabled=!this.checked,this.checked&&!o.value&&(o.value="5")}))}}function R(){if(console.log("Adding tax field, current count:",u),u>=5){alert("Максимальное количество налогов - 5");return}u++;const t=document.getElementById("tax-container");if(!t)return;const e=document.createElement("div");e.className="tax-item",e.innerHTML=`
    <div class="input-group">
      <label for="tax-name-${u}">Название налога</label>
      <select id="tax-name-${u}" class="tax-select">
        <option value="УСН Доходы">УСН Доходы</option>
        <option value="УСН Доходы-Расходы">УСН Доходы-Расходы</option>
        <option value="ОСНО">ОСНО</option>
        <option value="Самозанятость">Самозанятость</option>
        <option value="Патент">Патент</option>
        <option value="НДС">НДС</option>
        <option value="Другой налог">Другой налог</option>
      </select>
    </div>
    <div class="input-group">
      <label for="tax-rate-${u}">Ставка (%)</label>
      <input type="number" id="tax-rate-${u}" placeholder="0">
    </div>
  `,t.appendChild(e)}function i(t){const e=document.getElementById(t);if(!e)return console.error(`Element with id ${t} not found`),0;const o=parseFloat(e.value)||0;return console.log(`Value for ${t}:`,o),o}function C(){const t=[];for(let e=1;e<=12;e++){const o=document.getElementById(`holiday-${e}`);o&&o.checked&&t.push(e)}return console.log("Holiday months:",t),t}function X(){const t={};for(let e=1;e<=12;e++){const o=document.getElementById(`price-increase-${e}`),r=document.getElementById(`price-increase-value-${e}`);o&&o.checked&&r&&r.value&&(t[e]=parseFloat(r.value)/100)}return console.log("Price increases:",t),t}function H(){const t=[];for(let e=1;e<=u;e++){const o=document.getElementById(`tax-name-${e}`),r=document.getElementById(`tax-rate-${e}`);o&&r&&r.value&&t.push({name:o.value||o.options[o.selectedIndex].text,rate:parseFloat(r.value)/100})}return console.log("Taxes:",t),t}function O(){console.log("Calculating profit...");const t=i("revenue"),e=i("holiday-revenue"),o=C(),r=X(),n=i("rent"),s=i("household"),c=i("corporate"),l=i("salary"),a=i("salary-tax"),$=i("marketing"),M=i("other-expenses"),L=i("goods"),w=i("partner-share")/100,S=H();f=[];const k=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];let v=1;for(let p=1;p<=12;p++){let m=o.includes(p)?e:t;r[p]&&(v*=1+r[p]),m*=v;const B=n+s+c+l+a+$+M+L,h=m-B;let g=0;const P=[];S.forEach(x=>{const I=x.name.includes("Доходы-Расходы")?h*x.rate:m*x.rate;g+=I,P.push({name:x.name,amount:I})});const y=h-g,b=y*w,D=y-b;f.push({month:k[p-1],revenue:m,expenses:B,profitBeforeTax:h,taxes:P,totalTax:g,netProfit:y,partnerAmount:b,finalProfit:D})}_();const E=document.getElementById("results"),T=document.querySelector(".export-buttons");E&&(E.style.display="block"),T&&(T.style.display="flex")}function _(){console.log("Displaying results:",f);const t=document.getElementById("results-table");if(!t)return;const e=t.querySelector("tbody");if(!e)return;e.innerHTML="";let o=0,r=0,n=0,s=0;f.forEach(l=>{const a=document.createElement("tr");a.innerHTML=`
      <td>${l.month}</td>
      <td>${d(l.revenue)}</td>
      <td>${d(l.expenses)}</td>
      <td>${d(l.profitBeforeTax)}</td>
      <td>${d(l.totalTax)}</td>
      <td class="${l.finalProfit>=0?"positive":"negative"}">${d(l.finalProfit)}</td>
    `,e.appendChild(a),o+=l.revenue,r+=l.expenses,n+=l.totalTax,s+=l.finalProfit});const c=document.createElement("tr");c.className="total-row",c.innerHTML=`
    <td><strong>ИТОГО</strong></td>
    <td><strong>${d(o)}</strong></td>
    <td><strong>${d(r)}</strong></td>
    <td><strong>${d(o-r)}</strong></td>
    <td><strong>${d(n)}</strong></td>
    <td class="${s>=0?"positive":"negative"}"><strong>${d(s)}</strong></td>
  `,e.appendChild(c)}function d(t){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(t)}function N(){if(console.log("Exporting to Excel..."),typeof XLSX>"u"){alert("Библиотека для экспорта не загружена. Проверьте подключение к интернету.");return}const t=XLSX.utils.book_new();t.Props={Title:"Расчет прибыли бизнеса",Subject:"Расчет",Author:"Калькулятор прибыли",CreatedDate:new Date};const e=[["Месяц","Доход","Расходы","Прибыль до налогов","Налоги","Чистая прибыль"]];let o=0,r=0,n=0,s=0,c=0;f.forEach(a=>{e.push([a.month,a.revenue,a.expenses,a.profitBeforeTax,a.totalTax,a.finalProfit]),o+=a.revenue,r+=a.expenses,n+=a.profitBeforeTax,s+=a.totalTax,c+=a.finalProfit}),e.push(["ИТОГО",o,r,n,s,c]);const l=XLSX.utils.aoa_to_sheet(e);XLSX.utils.book_append_sheet(t,l,"Расчет прибыли"),XLSX.writeFile(t,"Расчет_прибыли_бизнеса.xlsx")}function A(){if(console.log("Exporting to PDF..."),typeof window.jspdf>"u"){alert("Библиотека для экспорта не загружена. Проверьте подключение к интернету.");return}const{jsPDF:t}=window.jspdf,e=new t,o=[];f.forEach(a=>{o.push([Math.round(a.revenue),Math.round(a.expenses),Math.round(a.profitBeforeTax),Math.round(a.totalTax),Math.round(a.finalProfit)])});let r=0,n=0,s=0,c=0,l=0;f.forEach(a=>{r+=a.revenue,n+=a.expenses,s+=a.profitBeforeTax,c+=a.totalTax,l+=a.finalProfit}),o.push([Math.round(r),Math.round(n),Math.round(s),Math.round(c),Math.round(l)]),e.autoTable({body:o,startY:20,theme:"grid",styles:{fontSize:10,cellPadding:3},alternateRowStyles:{fillColor:[245,245,245]}}),e.save("profit_data.pdf")}
